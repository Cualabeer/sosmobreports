<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SOS Mechanics – Customer Consent</title>

<style>
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Arial, sans-serif;
  background: #f6f7f8;
  color: #111;
}

header {
  background: #ffffff;
  padding: 16px;
  display: flex;
  align-items: center;
  gap: 12px;
  border-bottom: 2px solid #00e676;
}

header img {
  height: 42px;
}

header h1 {
  font-size: 1.05em;
  margin: 0;
  font-weight: 600;
}

.container {
  max-width: 560px;
  margin: auto;
  padding: 20px;
}

.card {
  background: #ffffff;
  border-radius: 14px;
  padding: 20px;
  box-shadow: 0 8px 20px rgba(0,0,0,0.08);
  margin-bottom: 16px;
}

.card h2 {
  margin-top: 0;
  font-size: 1em;
  color: #00b85c;
}

.card p {
  font-size: 0.9em;
  line-height: 1.5;
}

label {
  display: block;
  margin-top: 14px;
  font-weight: 600;
  font-size: 0.85em;
}

input {
  width: 100%;
  padding: 12px;
  margin-top: 6px;
  font-size: 0.95em;
  border-radius: 10px;
  border: 2px solid #ddd;
  background: #fff;
}

input.invalid {
  border-color: #e53935;
}

button {
  width: 100%;
  margin-top: 20px;
  padding: 18px;
  font-size: 1em;
  font-weight: 600;
  border-radius: 30px;
  border: none;
  background: linear-gradient(135deg, #00ff7f, #00e676);
  color: #000;
  opacity: 0.5;
}

button.enabled {
  opacity: 1;
  cursor: pointer;
}

.footer {
  text-align: center;
  font-size: 0.75em;
  color: #777;
  padding: 24px 10px;
}
</style>
</head>

<body>

<header>
  <img src="assets/logo.png" alt="SOS Mechanics">
  <h1>Customer Consent & Authorisation</h1>
</header>

<div class="container">

  <!-- CUSTOMER INITIATED REQUEST -->
  <div class="card">
    <h2>Customer-Initiated Request</h2>
    <p>
      All diagnostic or repair work on this vehicle is <strong>requested by the customer</strong>.  
      SOS Mechanics does not recommend or perform any work without explicit customer instruction.
    </p>
  </div>

  <!-- LIABILITY & POLICE -->
  <div class="card">
    <h2>Liability & Authority</h2>
    <p>
      The customer confirms they have full legal authority to authorise work on this vehicle.  
      SOS Mechanics is not liable for undisclosed information or misinformation.  
      Police may be contacted immediately if any safety or legal issues arise.  
      The customer acknowledges that all information provided is truthful to the best of their knowledge.
    </p>
  </div>

  <!-- CUSTOMER DETAILS -->
  <div class="card">
    <h2>Customer Details</h2>
    <label>Full Name (type to consent)</label>
    <input type="text" id="custName" placeholder="Your full name">
  </div>

  <!-- AUTOMATIC DATE/TIME/LOCATION -->
  <div class="card">
    <h2>Consent Record</h2>
    <p id="timestamp">Date & Time: --</p>
    <p id="location">Location: --</p>
    <p id="jobRef">Job Reference: --</p>
  </div>

  <!-- AGREE BUTTON -->
  <button id="agreeBtn" disabled>AGREE & AUTHORISE WORK</button>

</div>

<div class="footer">
  SOS Mechanics · Mobile Mechanic Consent Record · Must be agreed before work starts
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
const nameInput = document.getElementById("custName");
const agreeBtn = document.getElementById("agreeBtn");
const timestampEl = document.getElementById("timestamp");
const locationEl = document.getElementById("location");
const jobRefEl = document.getElementById("jobRef");

// Enable button only when name is typed
nameInput.addEventListener("input", () => {
  if(nameInput.value.trim().length > 0){
    agreeBtn.disabled = false;
    agreeBtn.classList.add("enabled");
  } else {
    agreeBtn.disabled = true;
    agreeBtn.classList.remove("enabled");
  }
});

// On click: generate job ref, timestamp, location, PDF
agreeBtn.addEventListener("click", () => {
  const name = nameInput.value.trim();
  const now = new Date();
  const nowString = now.toLocaleString();
  let locationText = "Unavailable";

  // generate Job Ref: SOSCONSENT-<name><timestamp>
  const jobRef = `SOSCONSENT-${name.replace(/\s+/g,'').toUpperCase()}-${now.getTime().toString().slice(-6)}`;

  timestampEl.textContent = `Date & Time: ${nowString}`;
  jobRefEl.textContent = `Job Reference: ${jobRef}`;

  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(
      pos => {
        locationText = `Lat ${pos.coords.latitude.toFixed(6)}, Lon ${pos.coords.longitude.toFixed(6)}`;
        locationEl.textContent = `Location: ${locationText}`;
        savePDF(name, nowString, locationText, jobRef);
      },
      () => {
        locationEl.textContent = `Location: ${locationText}`;
        savePDF(name, nowString, locationText, jobRef);
      }
    );
  } else {
    locationEl.textContent = `Location: ${locationText}`;
    savePDF(name, nowString, locationText, jobRef);
  }
});

function savePDF(name, dateTime, location, jobRef){
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF();

  const content = `
SOS MECHANICS – CUSTOMER CONSENT & AUTHORISATION

Job Reference: ${jobRef}
Customer Name: ${name}
Date & Time: ${dateTime}
Location: ${location}

1. Customer has requested all work. No work performed without instruction.
2. SOS Mechanics is not liable for misinformation or undisclosed facts.
3. Police may be contacted for safety or legal issues.
4. Customer confirms authority to authorise this vehicle.
`;

  pdf.setFontSize(11);
  pdf.text(content, 10, 10);
  pdf.save(`${jobRef}.pdf`);

  alert(`Consent recorded.\nJob Ref: ${jobRef}\nPDF downloaded.`);
}
</script>

</body>
</html>