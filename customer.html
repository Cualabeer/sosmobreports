<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SOS Mechanics - Tesla Style</title>
<style>
  /* Tesla-inspired dark theme */
  body { font-family: 'Roboto', sans-serif; margin:0; padding:0; background:#121212; color:#fff; }
  header { position:fixed; top:0; width:100%; text-align:center; padding:15px 0; z-index:1000; background:#000; font-size:20px; font-weight:500; }
  main { padding:80px 20px 100px; max-width:480px; margin:auto; }
  .card { background:#1c1c1c; padding:20px; margin-bottom:20px; border-radius:15px; box-shadow:0 4px 12px rgba(0,0,0,0.5); transition:0.3s; }
  .card:hover { box-shadow:0 6px 18px rgba(255,0,0,0.3); }
  input { width:100%; padding:12px; margin:10px 0; border:none; border-radius:10px; background:#2a2a2a; color:#fff; font-size:16px; }
  button { width:100%; padding:15px; border:none; border-radius:10px; font-size:18px; font-weight:500; background:#e60000; color:#fff; cursor:pointer; margin-top:10px; transition:0.2s; }
  button:disabled { background:#444; cursor:not-allowed; }
  .service-grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  .service-card { background:#2a2a2a; padding:12px; border-radius:10px; text-align:center; cursor:pointer; transition:0.3s; }
  .service-card.selected { background:#e60000; color:#fff; }
  #qrModal { display:none; position:fixed; inset:0; background:rgba(0,0,0,0.85); z-index:2000; justify-content:center; align-items:center; flex-direction:column; color:#fff; }
  #pinDisplay { font-size:30px; font-weight:bold; background:#000; padding:15px 25px; margin-top:15px; border-radius:10px; filter:blur(6px); transition:filter 0.5s; }
</style>
</head>
<body>

<header>SOS Mechanics</header>

<main>
  <div class="card" id="contactCard">
    <h2>Contact & Vehicle Info</h2>
    <input type="text" id="name" placeholder="Full Name" required>
    <input type="tel" id="phone" placeholder="Phone Number" required>
    <input type="text" id="make" placeholder="Vehicle Make" required>
    <input type="text" id="model" placeholder="Vehicle Model" required>
    <input type="number" id="year" placeholder="Year" required>
    <input type="text" id="reg" placeholder="Registration / Plate" required>
    <input type="text" id="location" placeholder="Address / GPS" required>
  </div>

  <div class="card">
    <h2>Select Services</h2>
    <div class="service-grid">
      <div class="service-card" data-price="55">Oil Change<br>£55</div>
      <div class="service-card" data-price="45">Spark Plugs<br>£45</div>
      <div class="service-card" data-price="35">Coolant Check<br>£35</div>
      <div class="service-card" data-price="70">Engine Diagnostics<br>£70</div>
      <div class="service-card" data-price="60">Brake Pads<br>£60</div>
      <div class="service-card" data-price="30">Brake Fluid<br>£30</div>
    </div>
  </div>

  <div class="card">
    <label><input type="checkbox" id="agree"> I agree to the total price</label>
  </div>

  <div class="card">
    <p>Total Price: £<span id="totalPrice">0</span></p>
    <button id="generateQR" disabled>Generate QR + PIN</button>
  </div>
</main>

<!-- QR Modal -->
<div id="qrModal" class="flex-center">
  <canvas id="qrCanvas"></canvas>
  <div id="pinDisplay"></div>
  <button onclick="closeModal()">Done</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
<script>
  const serviceCards = document.querySelectorAll('.service-card');
  const totalEl = document.getElementById('totalPrice');
  const agree = document.getElementById('agree');
  const generateBtn = document.getElementById('generateQR');
  let selectedServices = [];

  serviceCards.forEach(card=>{
    card.addEventListener('click', ()=>{
      card.classList.toggle('selected');
      const name = card.innerText.split('\n')[0];
      if(card.classList.contains('selected')) selectedServices.push(name);
      else selectedServices = selectedServices.filter(s=>s!==name);
      updateTotal();
    });
  });

  function updateTotal(){
    let total = 0;
    selectedServices.forEach(s=>{
      const card = Array.from(serviceCards).find(c=>c.innerText.startsWith(s));
      total += parseInt(card.dataset.price);
    });
    totalEl.innerText = total;
    generateBtn.disabled = !agree.checked || total===0;
  }

  agree.addEventListener('change', updateTotal);

  function generatePIN() { return Math.floor(1000 + Math.random()*9000); }

  generateBtn.addEventListener('click', ()=>{
    const data = {
      name: document.getElementById('name').value,
      phone: document.getElementById('phone').value,
      vehicle: document.getElementById('make').value + ' ' + document.getElementById('model').value,
      year: document.getElementById('year').value,
      reg: document.getElementById('reg').value,
      location: document.getElementById('location').value,
      services: selectedServices,
      total: totalEl.innerText
    };
    const pin = generatePIN();
    const qr = new QRious({
      element: document.getElementById('qrCanvas'),
      value: JSON.stringify({...data,pin}),
      size: 250
    });
    const pinDisplay = document.getElementById('pinDisplay');
    pinDisplay.innerText = pin;
    document.getElementById('qrModal').style.display = 'flex';
    setTimeout(()=>{ pinDisplay.style.filter='blur(0)'; },2000);
  });

  function closeModal(){
    document.getElementById('qrModal').style.display='none';
    serviceCards.forEach(c=>c.classList.remove('selected'));
    selectedServices=[];
    totalEl.innerText=0;
    agree.checked=false;
    generateBtn.disabled=true;
    document.querySelectorAll('input').forEach(i=>i.value='');
  }
</script>
</body>
</html>