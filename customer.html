<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Car Service Booking</title>
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f5f5f5; }
  header { position:fixed; top:0; left:0; width:100%; background:#222; color:#fff; text-align:center; padding:10px 0; z-index:1000; }
  main { padding:70px 15px 15px; max-width:600px; margin:auto; }
  h2 { margin:15px 0; }
  label { display:block; margin:10px 0 5px; font-weight:bold; }
  input, select, textarea, button { width:100%; padding:10px; margin-bottom:10px; border-radius:5px; border:1px solid #ccc; box-sizing:border-box; }
  button { background:#222; color:#fff; font-weight:bold; cursor:pointer; }
  .accordion { background:#eee; cursor:pointer; padding:10px; border-radius:5px; margin-bottom:5px; }
  .panel { display:none; padding:0 10px; background:white; border-radius:5px; margin-bottom:5px; }
  #qrContainer { text-align:center; margin:20px 0; }
  #emergencyPopup { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); backdrop-filter:blur(5px); padding:20px; box-sizing:border-box; z-index:2000; }
  #emergencyPopup .popupContent { background:white; padding:20px; border-radius:10px; max-width:500px; margin:50px auto; }
</style>
</head>
<body>

<header>
  Car Service Booking
</header>

<main>
  <h2>Build Your Service Package</h2>
  
  <label for="reg">Car Registration</label>
  <input type="text" id="reg" placeholder="Enter registration">

  <label for="carModel">Car Model</label>
  <input type="text" id="carModel" placeholder="Enter car model">

  <label>Choose Service Type</label>
  <select id="serviceType">
    <option value="normal">Normal</option>
    <option value="emergency">Emergency</option>
  </select>

  <div id="servicesAccordion">
    <div class="accordion">Engine Services</div>
    <div class="panel">
      <input type="checkbox" value="Oil Change"> Oil Change<br>
      <input type="checkbox" value="Spark Plugs Replacement"> Spark Plugs Replacement<br>
      <input type="checkbox" value="Air Filter Replacement"> Air Filter Replacement<br>
      <input type="checkbox" value="Coolant Flush"> Coolant Flush<br>
      <input type="checkbox" value="Timing Belt Check"> Timing Belt Check
    </div>
    <div class="accordion">Brakes</div>
    <div class="panel">
      <input type="checkbox" value="Brake Pads Replacement"> Brake Pads Replacement<br>
      <input type="checkbox" value="Brake Fluid Change"> Brake Fluid Change<br>
      <input type="checkbox" value="Disc Check"> Disc Check<br>
      <input type="checkbox" value="Brake Caliper Service"> Brake Caliper Service<br>
      <input type="checkbox" value="Handbrake Adjustment"> Handbrake Adjustment
    </div>
    <!-- Add more sections as needed -->
  </div>

  <button id="generateBtn">Generate QR</button>

  <div id="qrContainer"></div>
</main>

<!-- Emergency Popup -->
<div id="emergencyPopup">
  <div class="popupContent">
    <h2>Emergency Breakdown</h2>
    <label for="emergencyIssue">Issue</label>
    <input type="text" id="emergencyIssue" placeholder="Short issue description">
    <label for="emergencyPhone">Phone Number</label>
    <input type="text" id="emergencyPhone" placeholder="Your phone number">
    <label for="emergencyLocation">Location</label>
    <input type="text" id="emergencyLocation" placeholder="Type or use GPS">
    <button onclick="sendEmergency()">Send Emergency</button>
    <button onclick="closeEmergency()">Cancel</button>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
<script>
  // Accordion toggle
  const acc = document.getElementsByClassName("accordion");
  for (let i = 0; i < acc.length; i++) {
    acc[i].addEventListener("click", function() {
      this.classList.toggle("active");
      const panel = this.nextElementSibling;
      panel.style.display = panel.style.display === "block" ? "none" : "block";
    });
  }

  // Show emergency popup if selected
  const serviceType = document.getElementById("serviceType");
  const emergencyPopup = document.getElementById("emergencyPopup");

  serviceType.addEventListener("change", () => {
    if(serviceType.value === "emergency") {
      emergencyPopup.style.display = "block";
    }
  });

  function closeEmergency() {
    emergencyPopup.style.display = "none";
    serviceType.value = "normal";
  }

  // Generate QR for normal service
  const generateBtn = document.getElementById("generateBtn");
  generateBtn.addEventListener("click", () => {
    if(serviceType.value === "normal") {
      const reg = document.getElementById("reg").value;
      const carModel = document.getElementById("carModel").value;
      const services = [];
      document.querySelectorAll('#servicesAccordion input[type=checkbox]:checked').forEach(cb => services.push(cb.value));
      const jobData = {
        jobType: "normal",
        reg, carModel, services,
        timestamp: new Date().toISOString()
      };
      QRCode.toCanvas(document.getElementById("qrContainer"), JSON.stringify(jobData), {width:200});
    }
  });

  // Send Emergency via WhatsApp + generate QR
  function sendEmergency() {
    const reg = document.getElementById("reg").value;
    const carModel = document.getElementById("carModel").value;
    const issue = document.getElementById("emergencyIssue").value;
    const phone = document.getElementById("emergencyPhone").value;
    const location = document.getElementById("emergencyLocation").value;
    const timestamp = new Date().toLocaleString();

    const jobData = {
      jobType: "emergency",
      reg, carModel, issue, location, contact: phone,
      timestamp
    };

    // Generate QR
    QRCode.toCanvas(document.getElementById("qrContainer"), JSON.stringify(jobData), {width:200});

    // Create WhatsApp link
    const waMsg = `ðŸš¨ Emergency Breakdown
Reg: ${reg}
Car: ${carModel}
Location: ${location}
Issue: ${issue}
Phone: ${phone}
Time: ${timestamp}`;
    const waLink = `https://wa.me/07405937104?text=${encodeURIComponent(waMsg)}`;
    window.open(waLink, "_blank");

    emergencyPopup.style.display = "none";
    serviceType.value = "normal"; // reset
  }
</script>

</body>
</html>