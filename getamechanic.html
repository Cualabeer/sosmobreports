<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SOS Mechanics - Mobile Mechanic Booking</title>
<meta name="description" content="Book a mobile mechanic in Medway. Weekday, weekend, and out-of-hours service with transparent pricing. Quick quote & WhatsApp booking.">
<style>
body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; padding:0; color:#111; }
.container { max-width:800px; margin:20px auto; padding:20px; }
h1, h2 { color:#6f2dff; text-align:center; }
.card { background:#fff; border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.1); padding:20px; margin:20px 0; }
label { display:block; margin:10px 0 5px; font-size:18px; font-weight:bold; }
input, select, textarea { width:100%; padding:12px; font-size:16px; border:1px solid #ccc; border-radius:5px; }
button { background:#6f2dff; color:#fff; border:none; padding:15px; font-size:16px; border-radius:5px; cursor:pointer; margin-top:10px; }
button:hover { background:#5a24cc; }
#quickQuote, #hoverPrice { font-weight:bold; margin-top:10px; color:#222; font-size:16px; }
.popup { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.6); justify-content:center; align-items:center; }
.popup-content { background:#fff; padding:30px; border-radius:10px; max-width:400px; text-align:center; }
</style>
</head>
<body>
<div class="container">
  <h1>SOS Mechanics</h1>
  <h2>Quick Quote & Book Your Mobile Mechanic</h2>

  <!-- Quick Quote Calculator -->
  <div class="card">
    <label for="quickDay">Select Day</label>
    <input type="date" id="quickDay">

    <label for="quickTime">Select Time</label>
    <input type="time" id="quickTime" min="09:00" max="17:00" step="3600">

    <label for="quickService">Select Service</label>
    <select id="quickService" title="Hover to see total price">
      <option value="">-- Select --</option>
    </select>
    <p id="hoverPrice">Hover over a service to see total price</p>
    <p id="quickQuote">Total Quote: £0</p>
    <button id="quickBook">Book Now</button>
  </div>

  <!-- Booking Form -->
  <div class="card">
    <form id="bookingForm" action="https://formspree.io/f/xaqdykza" method="POST">
      <!-- Honeypot for spam protection -->
      <input type="text" name="website" style="display:none" autocomplete="off">

      <label for="name">Full Name *</label>
      <input type="text" id="name" name="name" required>

      <label for="phone">Phone Number *</label>
      <input type="tel" id="phone" name="phone" required>

      <label for="email">Email</label>
      <input type="email" id="email" name="email">

      <label for="vehicle">Vehicle Details *</label>
      <input type="text" id="vehicle" name="vehicle" required>

      <label for="address">Service Address *</label>
      <input type="text" id="address" name="address" required>

      <button type="button" id="getLocation">Use GPS for Lat/Lon</button>

      <label for="service">Service Selected *</label>
      <input type="text" id="service" name="service" readonly required>

      <label for="date">Preferred Date *</label>
      <input type="date" id="date" name="date" required>

      <label for="time">Preferred Time *</label>
      <input type="time" id="time" name="time" min="09:00" max="17:00" step="3600" required>

      <button type="submit">Submit Booking</button>
    </form>
  </div>
</div>

<!-- Confirmation Popup -->
<div class="popup" id="confirmPopup">
  <div class="popup-content" id="popupContent">
    <h3>Booking Submitted!</h3>
    <p id="popupDetails"></p>
    <button onclick="closePopup()">Close</button>
  </div>
</div>

<script>
// Pricing Constants
const callOut = 50;
const weekendSurcharge = 55;
const oohSurcharge = 65;

// Service Base Prices
const baseOptions = [
  {name: "Front Brake Pads", base: 80},
  {name: "Rear Brake Pads", base: 75},
  {name: "Full Brake Replacement", base: 150},
  {name: "Battery Replacement", base: 60},
  {name: "Oil & Filter", base: 50},
  {name: "Suspension Job", base: 120},
  {name: "Diagnostics", base: 40}
];

// DOM Elements
const quickService = document.getElementById('quickService');
const quickDay = document.getElementById('quickDay');
const quickTime = document.getElementById('quickTime');
const quickQuote = document.getElementById('quickQuote');
const quickBook = document.getElementById('quickBook');
const hoverPrice = document.getElementById('hoverPrice');
const form = document.getElementById('bookingForm');

// Limit date picker to today + 1 week
const today = new Date();
const maxDate = new Date();
maxDate.setDate(today.getDate() + 7);
quickDay.min = today.toISOString().split('T')[0];
quickDay.max = maxDate.toISOString().split('T')[0];

// Calculate total
function calculateQuote() {
  const serviceOption = quickService.selectedOptions[0];
  if(!serviceOption || !quickDay.value || !quickTime.value) return 0;

  const base = parseFloat(serviceOption.dataset.base);
  const day = new Date(quickDay.value).getDay();
  const hour = parseInt(quickTime.value.split(":")[0]);
  let surcharge = 0;

  if(day === 0 || day === 6) surcharge = weekendSurcharge;
  else if(hour < 9 || hour >= 17) surcharge = oohSurcharge;

  const total = base + callOut + surcharge;
  quickQuote.textContent = `Total Quote: £${total.toFixed(2)}`;
  return total;
}

// Populate Service Options dynamically
function updateServiceOptions() {
  if(!quickDay.value || !quickTime.value) return;

  const day = new Date(quickDay.value).getDay();
  const hour = parseInt(quickTime.value.split(":")[0]);
  let surcharge = 0;
  let labelSuffix = "";

  if(day === 0 || day === 6) { surcharge = weekendSurcharge; labelSuffix=" (Weekend +£55)"; }
  else if(hour < 9 || hour >= 17) { surcharge = oohSurcharge; labelSuffix=" (Out-of-Hours +£65)"; }
  else { surcharge = 0; labelSuffix=" (Weekday)"; }

  quickService.innerHTML = '<option value="">-- Select --</option>';
  baseOptions.forEach(opt=>{
    const total = opt.base + callOut + surcharge;
    const option = document.createElement("option");
    option.value = opt.name;
    option.dataset.base = opt.base;
    option.textContent = `${opt.name} – £${total.toFixed(2)}${labelSuffix}`;
    option.title = `Total Price: £${total.toFixed(2)}`;
    quickService.appendChild(option);
  });
  calculateQuote();
}

// Event Listeners
quickDay.addEventListener('change', updateServiceOptions);
quickTime.addEventListener('change', updateServiceOptions);
quickService.addEventListener('change', calculateQuote);

// Hover price preview
quickService.addEventListener('mousemove', () => {
  const option = quickService.selectedOptions[0];
  if(!option || option.value==="") return;
  hoverPrice.textContent = option.title;
});
quickService.addEventListener('mouseleave', () => {
  hoverPrice.textContent = "Hover over a service to see total price";
});

// Quick Book Button
quickBook.addEventListener('click', () => {
  const serviceOption = quickService.selectedOptions[0];
  if(!serviceOption || !quickDay.value || !quickTime.value){
    alert("Please select service, day, and time."); return;
  }
  const total = calculateQuote();
  form.service.value = `${serviceOption.value} – £${total.toFixed(2)}`;
  form.date.value = quickDay.value;
  form.time.value = quickTime.value;
  form.scrollIntoView({behavior:'smooth'});
});

// GPS Button
document.getElementById('getLocation').addEventListener('click', () => {
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
      const lat = pos.coords.latitude.toFixed(6);
      const lon = pos.coords.longitude.toFixed(6);
      document.getElementById('address').value = `Lat: ${lat}, Lon: ${lon}`;
    },()=>alert("Unable to get location."));
  } else alert("Geolocation not supported.");
});

// Form Submission with Popup & WhatsApp + Anti-Spam
let formStartTime = Date.now();
form.addEventListener('submit',(e)=>{
  e.preventDefault();

  if(form.website.value){
    alert("Bot detected. Submission blocked.");
    return;
  }

  const now = Date.now();
  if((now - formStartTime)/1000 < 5){
    alert("Form submitted too quickly. Please try again.");
    return;
  }

  const timestamp = new Date().toLocaleString();
  const name = form.name.value;
  const phone = form.phone.value;
  const email = form.email.value;
  const vehicle = form.vehicle.value;
  const address = form.address.value;
  const service = form.service.value;
  const date = form.date.value;
  const time = form.time.value;

  // WhatsApp link
  let mapLink = address;
  if(address.startsWith("Lat:")){
    const coords = address.replace("Lat:","").split(",").map(s=>s.replace("Lon:","").trim());
    const lat = coords[0].trim();
    const lon = coords[1].trim();
    mapLink = `https://www.google.com/maps/search/?api=1&query=${lat},${lon}`;
  }

  const waMessage = `Hello SOS Mechanics,%0ATimestamp: ${timestamp}%0AName: ${encodeURIComponent(name)}%0APhone: ${encodeURIComponent(phone)}%0AEmail: ${encodeURIComponent(email)}%0AVehicle: ${encodeURIComponent(vehicle)}%0AService: ${encodeURIComponent(service)}%0ALocation: ${encodeURIComponent(mapLink)}%0ADate & Time: ${encodeURIComponent(date)} ${encodeURIComponent(time)}`;
  window.open(`https://wa.me/447405937104?text=${waMessage}`,'_blank');

  // Show popup
  const popupDetails = document.getElementById('popupDetails');
  popupDetails.innerHTML = `
    <strong>Name:</strong> ${name}<br>
    <strong>Phone:</strong> ${phone}<br>
    <strong>Email:</strong> ${email}<br>
    <strong>Vehicle:</strong> ${vehicle}<br>
    <strong>Service:</strong> ${service}<br>
    <strong>Address:</strong> ${address}<br>
    <strong>Date & Time:</strong> ${date} ${time}<br>
    <strong>Timestamp:</strong> ${timestamp}
  `;
  document.getElementById('confirmPopup').style.display='flex';
  form.reset();
  quickQuote.textContent="Total Quote: £0";
  hoverPrice.textContent="Hover over a service to see total price";
  formStartTime = Date.now();
});

function closePopup(){document.getElementById('confirmPopup').style.display='none';}
</script>
</body>
</html>