<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SOS Mobile Report</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<style>
:root {
  --accent: #39ff14;
  --text: #111;
  --muted: #666;
}

/* Body */
body {
  font-family: system-ui, sans-serif;
  background: #fff;
  color: var(--text);
  margin:0;
  padding-top:64px;
  overflow-x: hidden;
}

/* Header */
header {
  position: fixed;
  top:0;
  left:0;
  width:100%;
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:16px;
  border-bottom:1px solid #eee;
  background:#fff;
  z-index:1000;
}
header .logo img {height:40px; max-width:60%;}
.hamburger {display:none; font-size:1.5rem; cursor:pointer;}
nav#menu {display:flex; gap:16px;}
nav#menu a {text-decoration:none; color:var(--text); font-weight:600;}
nav#menu a.current {color:var(--accent); text-shadow:0 0 8px var(--accent);}

/* Container */
.container {
  max-width:720px;
  width:100%;
  margin:auto;
  padding:32px 16px;
  box-sizing:border-box;
}
label {font-weight:600; display:block; margin-bottom:6px;}
input, select, textarea, button {
  width:100%;
  padding:12px;
  border-radius:6px;
  border:1px solid #ccc;
  box-sizing:border-box;
  margin-bottom:12px;
  font-size:16px;
}
textarea {min-height:90px;}
button {background:var(--accent); border:none; padding:14px; font-weight:700; border-radius:8px; cursor:pointer;}
img.preview {width:100%; display:block; margin-top:10px; border-radius:6px;}
footer {font-size:0.75rem; color:var(--muted); margin-top:48px;}
h3 {margin-top:24px;}

/* Mobile adjustments */
@media(max-width:768px){
  .hamburger {display:block;}
  nav#menu {display:none; flex-direction:column; width:100%; position:absolute; top:64px; left:0; background:#fff; border-top:1px solid #eee; padding:0; margin:0;}
  nav#menu a {padding:14px 16px; border-bottom:1px solid #eee; display:block;}
  nav#menu.active {display:flex;}
  section {margin-bottom:24px;}
}
</style>
</head>
<body>

<header>
  <div class="logo"><img src="assets/logo.png" alt="SOS Mechanics"></div>
  <div class="hamburger" onclick="toggleMenu()">â˜°</div>
  <nav id="menu">
    <a href="index.html">Home</a>
    <a href="sosmobilereports.html" class="current">Get Report</a>
  </nav>
</header>

<main class="container">
<h2>SOS Mobile Diagnostic Report</h2>
<small>This report was generated by SOS Mobile Reports</small>

<section>
  <label>Number Plate</label>
  <input id="plate" placeholder="ABC1234">
  <label>Vehicle</label>
  <input id="vehicle" placeholder="BMW 118i">
  <label>Report Type</label>
  <select id="type" onchange="toggleFull()">
    <option value="quick">Quick Check</option>
    <option value="full">Full Diagnostic</option>
  </select>
</section>

<section id="complaints">
  <h3>Customer Complaints</h3>
  <label>1.</label><input type="text" id="complaint1" placeholder="First complaint">
  <label>2.</label><input type="text" id="complaint2" placeholder="Second complaint">
  <label>3.</label><input type="text" id="complaint3" placeholder="Third complaint">
</section>

<section id="battery">
  <h3>Battery & Electrical Check</h3>
  <label>Battery OK?</label>
  <select id="battery-quick">
    <option value="Yes">Yes</option>
    <option value="No">No</option>
  </select>

  <div id="battery-full">
    <label>Battery Voltage (V)</label>
    <input type="number" id="battery-voltage" step="0.1" placeholder="12.5">
    <label>Battery Health (%)</label>
    <input type="number" id="battery-health" step="1" placeholder="80">
    <label>Jump Start Required?</label>
    <select id="battery-jump">
      <option value="No">No</option>
      <option value="Yes">Yes</option>
    </select>
    <label>Crank Voltage (V)</label>
    <input type="number" id="crank-voltage" step="0.1" placeholder="10.5">
    <label>Alternator Voltage (V)</label>
    <input type="number" id="alternator-voltage" step="0.1" placeholder="14.2">
    <label>Notes</label>
    <textarea id="battery-notes"></textarea>
  </div>
</section>

<section id="physical">
  <h3>Physical Checks</h3>
  <label>Brakes OK?</label>
  <select id="brakes-quick">
    <option value="Yes">Yes</option>
    <option value="No">No</option>
  </select>
  <div id="physical-full">
    <label>Brakes / Pads / Fluid Notes</label><textarea id="brakes-notes"></textarea>
    <label>Engine Notes</label><textarea id="engine-notes"></textarea>
    <label>Lights / Dashboard Notes</label><textarea id="lights-notes"></textarea>
  </div>
</section>

<section id="location">
  <h3>Vehicle Location</h3>
  <button type="button" onclick="getLocation()">Get GPS Location</button>
  <label>Or enter manually:</label>
  <input type="text" id="manual-location" placeholder="Latitude, Longitude">
</section>

<section>
  <label>Observations</label>
  <textarea id="obs"></textarea>
</section>

<section id="live-section">
  <label>Live Data / ECU Codes</label>
  <textarea id="live"></textarea>
</section>

<section>
  <label>Recommendations</label>
  <textarea id="rec"></textarea>
</section>

<section>
  <label>Add Photos</label>
  <input type="file" accept="image/*" multiple onchange="previewImages(event)">
  <div id="previews"></div>
</section>

<section>
  <button onclick="generatePDF()">Download PDF Report</button>
</section>

<footer>
This report reflects vehicle condition at the time of inspection only. Findings are based on checks performed and do not guarantee future outcomes.
</footer>
</main>

<script>
let images = [];
function toggleMenu(){document.getElementById("menu").classList.toggle("active");}
function previewImages(event){
  const files = event.target.files;
  const previews = document.getElementById("previews");
  previews.innerHTML=""; images=[];
  for(let file of files){
    const reader = new FileReader();
    reader.onload = e=>{
      images.push(e.target.result);
      const img = document.createElement("img"); img.src=e.target.result; img.className="preview";
      previews.appendChild(img);
    };
    reader.readAsDataURL(file);
  }
}
function toggleFull(){
  const full = document.getElementById("type").value==="full";
  document.getElementById("battery-full").style.display = full?"block":"none";
  document.getElementById("physical-full").style.display = full?"block":"none";
  document.getElementById("live-section").style.display = full?"block":"none";
}
toggleFull();

function getLocation(){
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(
      (pos)=>{
        const {latitude, longitude} = pos.coords;
        document.getElementById("manual-location").value = `${latitude.toFixed(6)}, ${longitude.toFixed(6)}`;
        alert("Location captured automatically!");
      },
      ()=>{alert("Unable to get GPS. Enter manually.");}
    );
  } else {alert("Geolocation not supported. Enter manually.");}
}

async function generatePDF(){
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF('p','mm','a4');

  const plate=document.getElementById("plate").value;
  const vehicle=document.getElementById("vehicle").value;
  const type=document.getElementById("type").value;
  const dateTime=new Date().toLocaleString();

  const obs=document.getElementById("obs").value;
  const live=document.getElementById("live").value;
  const rec=document.getElementById("rec").value;
  const c1=document.getElementById("complaint1").value;
  const c2=document.getElementById("complaint2").value;
  const c3=document.getElementById("complaint3").value;
  const batteryQuick=document.getElementById("battery-quick").value;
  const batteryVoltage=document.getElementById("battery-voltage").value;
  const batteryHealth=document.getElementById("battery-health").value;
  const batteryJump=document.getElementById("battery-jump").value;
  const crankVoltage=document.getElementById("crank-voltage").value;
  const alternatorVoltage=document.getElementById("alternator-voltage").value;
  const batteryNotes=document.getElementById("battery-notes").value;
  const brakesQuick=document.getElementById("brakes-quick").value;
  const brakesNotes=document.getElementById("brakes-notes").value;
  const engineNotes=document.getElementById("engine-notes").value;
  const lightsNotes=document.getElementById("lights-notes").value;
  const manualLocation=document.getElementById("manual-location").value;

  // --- TITLE PAGE ---
  pdf.setFontSize(24);
  pdf.text("Vehicle Report",105,80,{align:"center"});
  pdf.setFontSize(20);
  pdf.text(plate||"Number Plate",105,100,{align:"center"});
  pdf.setFontSize(16);
  pdf.text(vehicle||"Vehicle Details",105,120,{align:"center"});
  pdf.setFontSize(12);
  pdf.text(`Report generated on: ${dateTime}`,105,140,{align:"center"});
  pdf.text(`Generated by SOS Mobile Reports`,105,150,{align:"center"});

  // --- MAIN CONTENT PAGE ---
  pdf.addPage();
  let y=10;
  function addSection(title){
    pdf.setFontSize(12);
    pdf.text(title,10,y);
    const textWidth = pdf.getTextWidth(title);
    pdf.setLineWidth(0.5);
    pdf.line(10,y+1,10+textWidth,y+1);
    y+=6;
  }

  addSection("Customer Complaints");
  pdf.setFontSize(10);
  pdf.text(`The customer reported: ${c1||"no complaints"}${c2?", "+c2:""}${c3?", "+c3:""}.`,10,y,{maxWidth:180});
  y+=10;

  addSection("Battery & Electrical Check");
  let batteryText = type==="quick"?`Battery condition was ${batteryQuick}. Brakes were ${brakesQuick}.`:
      `Battery voltage: ${batteryVoltage||"-"}V, health: ${batteryHealth||"-"}%. Jump start ${batteryJump.toLowerCase()==="yes"?"was required":"was not required"}. Crank voltage: ${crankVoltage||"-"}V, alternator voltage: ${alternatorVoltage||"-"}V. Notes: ${batteryNotes||"none"}.`;
  pdf.text(batteryText,10,y,{maxWidth:180}); y+=10;

  addSection("Physical Checks");
  let physicalText = `Brakes notes: ${brakesNotes||"none"}. Engine notes: ${engineNotes||"none"}. Lights/dashboard notes: ${lightsNotes||"none"}.`;
  pdf.text(physicalText,10,y,{maxWidth:180}); y+=10;

  if(type==="full"){
    addSection("Live Data / ECU Codes");
    pdf.text(live||"No live data.",10,y,{maxWidth:180}); y+=10;
  }

  addSection("Observations");
  pdf.text(obs||"None.",10,y,{maxWidth:180}); y+=10;

  addSection("Recommendations");
  pdf.text(rec||"None.",10,y,{maxWidth:180}); y+=10;

  // --- IMAGES PAGE ---
  if(images.length){
    pdf.addPage();
    y=10;
    const scaleFactor=0.25; // quarter size
    for(let img of images){
      const imgProps = pdf.getImageProperties(img);
      const imgWidth = imgProps.width*scaleFactor;
      const imgHeight = imgProps.height*scaleFactor;
      if(y+imgHeight>270) break;
      pdf.addImage(img,"JPEG",10,y,imgWidth,imgHeight);
      y+=imgHeight+5;
    }
  }

  // Footer/Disclaimer
  pdf.setFontSize(7);
  pdf.text("Disclaimer: This report reflects vehicle condition at the time of inspection only. Fixes cannot be guaranteed.",10,280);

  pdf.save(`SOS_Report_${plate}.pdf`);
}
</script>

</body>
</html>