<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SOS Mobile Diagnostic Report</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
:root {
  --phi: 1.618;
  --accent: #39ff14;
  --text: #111;
  --muted: #666;
}

body {
  margin: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  background: white;
  color: var(--text);
}

.watermark {
  position: fixed;
  inset: 0;
  background-image: repeating-linear-gradient(
    45deg,
    rgba(57,255,20,0.04) 0px,
    rgba(57,255,20,0.04) 120px,
    transparent 120px,
    transparent 240px
  );
  pointer-events: none;
  z-index: 0;
}

.container {
  position: relative;
  z-index: 1;
  max-width: 720px;
  margin: auto;
  padding: calc(24px * var(--phi));
}

header {
  margin-bottom: calc(24px * var(--phi));
}

header h1 {
  margin: 0;
  font-size: 1.6rem;
}

header small {
  color: var(--muted);
}

section {
  margin-bottom: calc(20px * var(--phi));
}

label {
  font-weight: 600;
  display: block;
  margin-bottom: 6px;
}

input, select, textarea {
  width: 100%;
  padding: 10px;
  font-size: 1rem;
  border-radius: 6px;
  border: 1px solid #ccc;
}

textarea {
  min-height: 90px;
}

button {
  width: 100%;
  padding: 14px;
  font-size: 1rem;
  font-weight: 700;
  border-radius: 8px;
  border: none;
  background: var(--accent);
  cursor: pointer;
}

img.preview {
  width: 100%;
  border-radius: 6px;
  margin-top: 10px;
}

footer {
  font-size: 0.7rem;
  color: var(--muted);
  margin-top: calc(32px * var(--phi));
}
</style>
</head>

<body>

<div class="watermark"></div>

<div class="container">

<header>
  <h1 id="reportTitle">Vehicle Diagnostic Report</h1>
  <small>This report was generated by SOS Mobile Reports</small><br>
  <small id="meta"></small>
</header>

<section>
  <label>Number Plate</label>
  <input id="plate" oninput="updateTitle()">

  <label>Vehicle</label>
  <input id="vehicle">

  <label>Report Type</label>
  <select id="type">
    <option value="quick">Quick Check</option>
    <option value="full">Full Diagnostic</option>
  </select>
</section>

<section>
  <label>Initial Observations</label>
  <textarea id="obs"></textarea>
</section>

<section id="fullSection" style="display:none;">
  <label>Live Data / Diagnostic Notes</label>
  <textarea id="live"></textarea>
</section>

<section>
  <label>Recommendations (non-pricing)</label>
  <textarea id="rec"></textarea>
</section>

<section>
  <label>Add Photos</label>
  <input type="file" accept="image/*" multiple onchange="previewImages(event)">
  <div id="previews"></div>
</section>

<section>
  <button onclick="generatePDF()">Download PDF Report</button>
</section>

<footer>
  This report reflects vehicle condition at the time of inspection only.
  Findings are based on checks performed and do not guarantee future outcomes or repairs.
</footer>

</div>

<script>
const { jsPDF } = window.jspdf;
let images = [];
let locationText = "Location unavailable";

navigator.geolocation?.getCurrentPosition(pos => {
  const lat = pos.coords.latitude.toFixed(6);
  const lon = pos.coords.longitude.toFixed(6);
  locationText = `${lat}, ${lon}`;
  document.getElementById("meta").innerHTML =
    `${new Date().toLocaleString()} · <a href="https://maps.google.com/?q=${lat},${lon}" target="_blank">${locationText}</a>`;
});

document.getElementById("type").addEventListener("change", e => {
  document.getElementById("fullSection").style.display =
    e.target.value === "full" ? "block" : "none";
});

function updateTitle() {
  const plate = document.getElementById("plate").value || "—";
  document.getElementById("reportTitle").innerText =
    `Vehicle Diagnostic Report – ${plate}`;
}

function previewImages(event) {
  images = [];
  const previews = document.getElementById("previews");
  previews.innerHTML = "";

  for (let file of event.target.files) {
    const reader = new FileReader();
    reader.onload = e => {
      images.push(e.target.result);
      const img = document.createElement("img");
      img.src = e.target.result;
      img.className = "preview";
      previews.appendChild(img);
    };
    reader.readAsDataURL(file);
  }
}

function generatePDF() {
  const pdf = new jsPDF();
  let y = 14;

  pdf.setFontSize(14);
  pdf.text(document.getElementById("reportTitle").innerText, 10, y);
  y += 8;

  pdf.setFontSize(9);
  pdf.text(`Generated by SOS Mobile Reports`, 10, y); y += 5;
  pdf.text(`Date & Time: ${new Date().toLocaleString()}`, 10, y); y += 5;
  pdf.text(`Location: ${locationText}`, 10, y); y += 8;

  pdf.setFontSize(11);
  pdf.text("Observations:", 10, y); y += 6;
  pdf.setFontSize(10);
  pdf.text(document.getElementById("obs").value || "-", 10, y, { maxWidth: 180 });
  y += 18;

  if (document.getElementById("type").value === "full") {
    pdf.text("Live Data / Diagnostic Notes:", 10, y); y += 6;
    pdf.text(document.getElementById("live").value || "-", 10, y, { maxWidth: 180 });
    y += 18;
  }

  pdf.text("Recommendations:", 10, y); y += 6;
  pdf.text(document.getElementById("rec").value || "-", 10, y, { maxWidth: 180 });

  images.forEach(img => {
    pdf.addPage();
    pdf.addImage(img, "JPEG", 10, 20, 180, 120);
  });

  pdf.save(`SOS_Report_${document.getElementById("plate").value || "Vehicle"}.pdf`);
}
</script>

</body>
</html>